var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,a=Object.prototype.propertyIsEnumerable,i=(e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,n=(t,n)=>{for(var r in n||(n={}))e.call(n,r)&&i(t,r,n[r]);if(s)for(var r of s(n))a.call(n,r)&&i(t,r,n[r]);return t};import{o as r,c as o,e as l,h as c,v as h,i as d,j as p,f as u,t as f,F as w,k as m,l as v,w as b,r as y}from"./vendor.9944df43.js";import{_ as g}from"./univrse.ca8b79ff.js";class k{constructor(t){this.baseURL="https://txo.bitbus.network",this.token=t}crawl(t){const e={find:n(n({},t),{"blk.i":{$gte:683600}}),sort:{"blk.i":-1},limit:50};return fetch(this.baseURL+"/block",{method:"post",headers:{Accept:"application/x-ndjson","Content-type":"application/json; charset=utf-8",token:this.token},body:JSON.stringify({q:e})}).then((t=>t.text())).then((t=>t.split("\n").filter((t=>t.length)).map((t=>JSON.parse(t)))))}}class x{constructor(t){this.baseURL="https://txo.bitsocket.network",this.token=t,this.socket=null,this.lastEventId=null}crawl(t){const e={find:n(n({},t),{timestamp:{$gte:Date.now()-36e5}}),sort:{timestamp:-1},limit:50};return fetch(this.baseURL+"/crawl",{method:"post",headers:{Accept:"application/x-ndjson","Content-type":"application/json; charset=utf-8",token:this.token},body:JSON.stringify({q:e})}).then((t=>t.text())).then((t=>t.split("\n").filter((t=>t.length)).map((t=>JSON.parse(t)))))}listen(t,e){this.close();const s=btoa(JSON.stringify({q:{find:t}}));this.socket=new EventSource(this.baseURL+"/s/"+s,{headers:{"Last-Event-ID":this.lastEventId}}),this.socket.onmessage=t=>{"undefined"!==t.lastEventId&&(this.lastEventId=t.lastEventId);try{const{data:s,type:a}=JSON.parse(t.data);"push"===a&&e(s)}finally{}}}close(){this.socket&&(this.socket.close(),this.socket=null)}}class S{constructor(){this.baseURL="https://x.bitfs.network",this.cache={}}get(t){return this.cache[t]?this.cache[t]:fetch(this.baseURL+"/"+t).then((t=>t.arrayBuffer())).then((e=>{const s=btoa(String.fromCharCode(...new Uint8Array(e)));return this.cache[t]=s,s}))}async map(t){let e,s;for(let a=0;a<t.out.length;a++){e=t.out[a];for(let t=0;t<e.len;t++)if(s=e["f"+t]){const a=await this.get(s);e["b"+t]=a}}}}const{Envelope:O,Signature:U,Recipient:E}=window.Univrse,I={data:()=>({show:!1,payload:null,sign:!0,encrypt:!1}),methods:{open(){this.payload=null,this.show=!0,setTimeout((t=>{this.$refs.form.focus()}),250)},close(){this.show=!1},async create(){const t=O.wrap(this.payload,{proto:"univrse.demo"}),e=new window.moneyButton.IMB({clientIdentifier:"07a24628aa41070553073e5bc2e9b6cb",suggestedAmount:{amount:"0.01",currency:"USD"},permission:localStorage.getItem("UNIV_IMB_TOKEN"),onNewPermissionGranted(t){localStorage.setItem("UNIV_IMB_TOKEN",t)}});return this.sign&&await e.swipe({cryptoOperations:[{method:"sign",name:"sig",data:t.encodedPayload.toString("hex"),dataEncoding:"hex",key:"identity",algorithm:"bitcoin-signed-message"},{method:"paymail",name:"address",key:"identity"}]}).then((({cryptoOperations:e})=>{const s=e.find((t=>"sig"===t.name)).value,a=Uint8Array.from(atob(s),(t=>t.charCodeAt(0))),i=e.find((t=>"address"===t.name)).value,n=U.wrap(a,{alg:"ES256K-BSM",kid:i});t.pushSignature(n)})),this.encrypt&&await e.swipe({cryptoOperations:[{method:"encrypt",name:"cipher",data:t.encodedPayload.toString("hex"),dataEncoding:"hex",key:"identity",algorithm:"electrum-ecies"},{method:"paymail",name:"address",key:"identity"}]}).then((({cryptoOperations:e})=>{const s=e.find((t=>"cipher"===t.name)).value,a=Uint8Array.from(s.match(/.{1,2}/g),(t=>parseInt(t,16))),i=e.find((t=>"address"===t.name)).value;t.payload=a;const n=E.wrap(null,{alg:"ECDH-BIE1",kid:i});t.pushRecipient(n)})),e.swipe({outputs:[{amount:0,currency:"BSV",script:t.toScript().toAsmString()}],onPayment:t=>this.close(),onError:t=>{alert("An error occurred. Please check browser console."),console.log(t)}})}}},R={class:"w-100 mw7 center ph5 | modal"},N={class:"pa4 bg-black ba b--white-40"},A=l("p",{class:"mt0 mb4 f6 lh-copy fw3 white-80 tc"},[u(" Try "),l("span",{class:"white"},"Univrse"),u(" out by creating your own data envelope. Add some content to the payload, choose whether to sign and/or encrypt the payload, and tap the button. ")],-1),B={class:"flex bg-white-10"},$=l("div",{class:"w2 pv4 f7 fw4 white-80 ttu bg-white-20"},[l("div",{class:"heading"},"Payload")],-1),V={class:"flex-auto"},j={class:"list mv3 pa0 f6 lh-copy fw3 white-80"},C={class:"mb1 ph2"},J=u(" Sign payload "),D={class:"mb1 ph2"},L=u(" Encrypt payload "),T={class:"flex items-center"},F=l("span",{class:"flex-auto ph3 f7 fw3 i white-60"},"Accept Money Button permissions when prompted.",-1);I.render=function(t,e,s,a,i,n){return r(),o("div",{class:{"modal-show":i.show}},[l("a",{class:"db w4 center ph3 pv2 link f4 fw2 white-90 bg-animate hover-bg-white-10 ba b--white-30 br2 tc pointer",onClick:e[1]||(e[1]=t=>n.open())}," Try Univrse "),l("div",{class:"fixed top-0 bottom-0 left-0 right-0 z-4 flex flex-column justify-center bg-black-60 | modal-bg",onClick:e[7]||(e[7]=p((t=>n.close()),["self"]))},[l("div",R,[l("div",N,[A,l("div",B,[$,l("div",V,[c(l("textarea",{class:"input-reset w-100 pa2 ph3 code f6 lh-copy white-80 bg-transparent bn outline-0",ref:"form",rows:"3","onUpdate:modelValue":e[2]||(e[2]=t=>i.payload=t)},null,512),[[h,i.payload]])])]),l("div",null,[l("ul",j,[l("li",C,[l("label",null,[c(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>i.sign=t),class:"mr2 v-mid"},null,512),[[d,i.sign]]),J])]),l("li",D,[l("label",null,[c(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>i.encrypt=t),class:"mr2 v-mid"},null,512),[[d,i.encrypt]]),L])])])]),l("div",T,[l("a",{class:"db w4 ph3 pv2 link f4 fw2 white-90 ba b--white-30 br2 tc pointer",onClick:e[5]||(e[5]=t=>n.create())}," Create "),F,l("a",{class:"f7 fw6 link light-red hover-hot-pink pointer",onClick:e[6]||(e[6]=t=>n.close())}," Cancel ")])])])])],2)};const q={props:{env:{type:Object,required:!0},out:{type:String,required:!0},timestamp:{type:Number,required:!0}},computed:{wocLink(){return`https://whatsonchain.com/tx/${this.out.substring(0,64)}`},dateTime(){const t=new Date(1e3*this.timestamp);return`${t.getFullYear()}-${this.padDate(t.getMonth()+1)}-${this.padDate(t.getDate())} ${this.padDate(t.getHours())}:${this.padDate(t.getMinutes())}`},signatures(){return Array.isArray(this.env.signature)?this.env.signature:this.env.signature?[this.env.signature]:[]},recipients(){return Array.isArray(this.env.recipient)?this.env.recipient:this.env.recipient?[this.env.recipient]:[]}},methods:{padDate:t=>t.toString().padStart(2,0),formatted(t){return(t=JSON.parse(JSON.stringify(t)))&&"Buffer"===t.constructor.name?t={type:"Buffer",data:t.toString("base64")}:t&&"object"==typeof t&&"Buffer"===t.type&&Array.isArray(t.data)?t.data=btoa(String.fromCharCode(...t.data)):t&&Array.isArray(t)?t=t.map((t=>this.formatted(t))):t&&"object"==typeof t&&(t=Object.keys(t).reduce(((e,s)=>(e[s]=this.formatted(t[s]),e)),{})),t}}},M={class:"ph2 ba b--white-20"},P={class:"flex items-center mv2 bg-white-10"},Y={class:"flex-auto pa2 code f7 fw3 white-70"},z={class:"pa2 code f7 fw3 white-50"},H={class:"flex mv2 bg-white-10"},Z=l("div",{class:"w2 pv4 f7 fw7 white-90 ttu bg-blue"},[l("div",{class:"heading"},"Header")],-1),_={class:"flex-auto self-center ma0 pv2 ph3 code f7 lh-copy fw3 white-50 pre-wrap"},G={class:"flex mv2 bg-white-10"},W=l("div",{class:"w2 pv4 f7 fw7 white-90 ttu bg-green"},[l("div",{class:"heading"},"Payload")],-1),X={class:"flex-auto self-center ma0 pv2 ph3 code f7 fw3 white-70 pre-wrap"},K={key:0,class:"flex mv2 bg-white-10"},Q=l("div",{class:"w2 pv4b f7 fw7 white-90 ttu bg-hot-pink"},[l("div",{class:"heading"},"Signatures")],-1),tt={class:"flex-auto pa2"},et={class:"dt w-100 white-50",style:{"table-layout":"fixed"}},st=l("div",{class:"dt-row f7 lh-copy fw7 ttu white-70"},[l("div",{class:"dtc pa2"},"Header"),l("div",{class:"dtc pa2"},"Signature")],-1),at={class:"dt-row pv2 white-70"},it={class:"dtc pa2 bt b--white-20"},nt={class:"w-100 ma0 pa0 code f7 lh-copy fw3 white-50 pre-wrap"},rt={class:"dtc pa2 bt b--white-20"},ot={class:"w-100 ma0 pa0 code f7 lh-copy fw3 white-50 pre-wrap"},lt={key:1,class:"flex mv2 bg-white-10"},ct=l("div",{class:"w2 pv4b f7 fw7 white-90 ttu bg-purple"},[l("div",{class:"heading"},"Recipients")],-1),ht={class:"flex-auto pa2"},dt={class:"dt w-100 white-50",style:{"table-layout":"fixed"}},pt=l("div",{class:"dt-row f7 lh-copy fw7 ttu white-70"},[l("div",{class:"dtc pa2"},"Header"),l("div",{class:"dtc pa2"},"Key")],-1),ut={class:"dt-row pv2 white-70"},ft={class:"dtc pa2 bt b--white-20"},wt={class:"w-100 ma0 pa0 code f7 lh-copy fw3 white-50 pre-wrap"},mt={class:"dtc pa2 bt b--white-20"},vt={class:"w-100 ma0 pa0 code f7 lh-copy fw3 white-50 pre-wrap"};q.render=function(t,e,s,a,i,n){return r(),o("div",M,[l("div",P,[l("div",Y,[l("a",{class:"link white-70 hover-white",href:n.wocLink,target:"_blank"},f(s.out),9,["href"])]),l("div",z,f(n.dateTime),1)]),l("div",H,[Z,l("pre",_,f(n.formatted(s.env.header.headers)),1)]),l("div",G,[W,l("pre",X,f(n.formatted(s.env.payload)),1)]),n.signatures.length?(r(),o("div",K,[Q,l("div",tt,[l("div",et,[st,(r(!0),o(w,null,m(n.signatures,(t=>(r(),o("div",at,[l("div",it,[l("pre",nt,f(n.formatted(t.header.headers)),1)]),l("div",rt,[l("pre",ot,f(n.formatted(t.signature)),1)])])))),256))])])])):v("",!0),n.recipients.length?(r(),o("div",lt,[ct,l("div",ht,[l("div",dt,[pt,(r(!0),o(w,null,m(n.recipients,(t=>(r(),o("div",ut,[l("div",ft,[l("pre",wt,f(n.formatted(t.header.headers)),1)]),l("div",mt,[l("pre",vt,f(n.formatted(t.key)),1)])])))),256))])])])):v("",!0)])};const{Envelope:bt}=Univrse,yt="eyJhbGciOiJFUzI1NksiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiIxNFZ1YmF5NmJSRTdLM2tTSHp2SGhTVVhZcmRrU3BzVFFEIiwiaXNzdWVyIjoiZ2VuZXJpYy1iaXRhdXRoIn0.SDZ1WUE0ZDYxOHU2N0VRazYvL011U2FFdysvYzNxRlRtc2VoaFJWYnpOM3lYbk5MN2tFMDRkSGR1cTRTWHo1aVN0dlB3ZG5RYzdOaGplblpRYm1SWVZFPQ",gt={data:()=>({envs:[],txid:null,query:{"out.s2":"UNIV"}}),created(){this.$bitbus=new k(yt),this.$bitsocket=new x(yt),this.$bitfs=new S,this.crawl(),this.listen()},watch:{txid(t){t&&t.match(/^[a-f0-9]{64}$/i)?(this.$bitsocket.close(),this.query["tx.h"]=t,this.crawl()):null!==t&&""!==t||(delete this.query["tx.h"],this.crawl(),this.listen())}},methods:{crawl(){this.envs=[],this.$bitbus.crawl(this.query).then((t=>this.handleResults(t))),this.$bitsocket.crawl(this.query).then((t=>this.handleResults(t)))},listen(){this.$bitsocket.listen(this.query,(t=>{this.handleResults(t)}))},handleResults(t){t.forEach((async t=>{await this.$bitfs.map(t);Shapeshifter.toTx(t).txOuts.forEach(((e,s)=>{try{const a=t.timestamp?Math.round(t.timestamp/1e3):t.blk.t,i=`${t.tx.h}.out.${s}`,n=bt.fromScript(e.script);this.push({out:i,env:n,t:a})}catch(a){}}))}))},push(t){if(!this.envs.some((({out:e})=>e===t.out))){const e=this.envs.findIndex((({t:e})=>e<t.t));e>=0?this.envs.splice(e,0,t):this.envs.push(t),this.envs=this.envs.slice(0,50)}}},components:{Builder:I,Envelope:q}},kt={class:"mb3 pv4"},xt={class:"mt0 mb2 f-subheadline fw1 ttu tracked-mega white-90 tc"},St=l("img",{src:g,width:"235",alt:"Univrse"},null,-1),Ot={class:"ma0 f7 fw3 tc"},Ut=u("← Back to home"),Et={class:"mw7 pv3 center"},It={class:""},Rt=l("label",{for:"search",class:"db mb2 f7 fw3 tracked lh-copy white-70 tc"},"Search by TXID",-1),Nt={class:"mw7 pv3 center"},At={class:"list ma0 mv3 pa0"},Bt=l("div",{class:"mw7 pt4 pb3 center"},[l("p",{class:"mv1 f7 lh-copy fw3 white-60 tc"}," Univrse Explorer powered by Bitbus, Bitsocket and BitFS. "),l("p",{class:"mv1 f7 lh-copy fw3 white-60 tc"}," © Copyright 2021 Chronos Labs Ltd ")],-1);gt.render=function(t,e,s,a,i,n){const d=y("router-link"),p=y("Builder"),u=y("Envelope");return r(),o(w,null,[l("div",kt,[l("h1",xt,[l(d,{to:"/"},{default:b((()=>[St])),_:1})]),l("p",Ot,[l(d,{to:"/",class:"link white-80 hover-hot-pink"},{default:b((()=>[Ut])),_:1})])]),l("div",Et,[l("div",It,[Rt,c(l("input",{type:"text",id:"search",class:"input-reset w-100 pa2 ph3 code f5 lh-copy white bg-transparent ba b--white-30 br2","onUpdate:modelValue":e[1]||(e[1]=t=>i.txid=t)},null,512),[[h,i.txid]])])]),l("div",Nt,[l(p,{class:"mb4"}),l("ul",At,[(r(!0),o(w,null,m(i.envs,(t=>(r(),o("li",{key:t.out,class:"mb3"},[l(u,{env:t.env,out:t.out,timestamp:t.t},null,8,["env","out","timestamp"])])))),128))])]),Bt],64)};export default gt;
